<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3c.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>DisherNet Internet Access EUN</title>
<script language="JavaScript">
var company = "Dishernet Prestige WorldWide";
var defLang='en_US'</script>
<script type='text/javascript'>
var params = {};
if (location.search) {
    var parts = location.search.substring(1).split('&');
    for (var i = 0; i < parts.length; i++) {
        var nv = parts[i].split('=');
        if (!nv[0]) continue;
        params[nv[0]] = nv[1] || true;
    }
}
var url = decodeURIComponent(params.url);
var reasoncode = params.reasoncode;
var cat = (params.cat).replace(/\+/g, " ");;
var user = params.user;
var zsq = params.zsq;
var sm_rid = zsq.substring(0, zsq.length - 3);
</script>
<style type="text/css">
	/* 1em = 12pt = 16px = 100% */
	body
	{
			font-size: 100%;
	}
	fieldset.outer
	{
		width: 800px;
		margin: 50px auto 0 auto;
		padding: 0 5px 5px 10px;
		background: #0053BA;
		border: 2px solid #000000;
		border-radius: 10px;
		-webkit-border-radius: 10px;
		-moz-border-radius: 10px;
	}
	fieldset.outer legend
	{
		color: #000000;
		background: #ffffff;
		padding: 10px 10px;
		border: 2px solid #000000;
		border-radius: 8px;
		-webkit-border-radius: 8px;
		-moz-border-radius: 8px;
	}
	fieldset.inner
	{
		width: 760px;
		margin: 23px 29px 27px 21px;
		padding: 10px 10px 5px 10px;
		background-color: #ffffff;
		border: 2px solid #000000;
		border-radius: 8px;
		-webkit-border-radius: 8px;
		-moz-border-radius: 8px;
	}
	label
	{
		display: block;
		margin: 0 0 15px 0;
		font-weight: normal;
	}
	h2
	{
		text-align: center;
		font-family: sans-serif;
		font-weight: bold;
		font-size: 100%;
	}
	h3
	{
		text-align: left;
		font-family: sans-serif;
		font-weight: normal;
		font-size: 100%;
	}
	a
	{
		text-decoration: none;
	}
</style>
</head>
<body bgcolor=#FFFFFF>

<fieldset class=outer>
	<legend>
		<b><script>document.write(company);</script></b> - <i>Access Notification</i>
	</legend>
<fieldset class=inner>
	<div align="center"><img src="NoFlo320.gif"></div>
	<h2>Hello <font style="color:blue"><script>document.write(user);</script></font></h2>
	<h2>Our policy definition does not allow access to the following site:</h2>
	
	<?php
		// WE need to wrap the site and referrer because they can ruin the display
		// if we don't
		echo "<h2>Site:<br>";
		echo "<font style=\"color:blue\">";
		echo wordwrap($_GET['url'],40,"<br>\n",true);
		echo "</font>";
		echo "</h2>";

	?>
	
	<h2>This site is categorized as: <font style="color:red"><script>document.write(cat);</script></font></h2>
	<hr>
	<h3><b>Other data points about this transaction:</b></h3>
<div class="subc">


<pre>
<?php

/* If there is a referrer, wordwrap it then echo it */
if ($_GET['referer']){
	echo '-Referer: '.$referer = wordwrap($_GET['referer'],40,"<br>\n",true).'<br>';
} else {
	echo "-No Referring Page<br>";
}

/* URL is already echoed at the top */
// echo 'URL: '.$url = $_GET['url'].'<br>';


/* Echo Reason_Code */
if ($_GET['reasoncode']){
	echo '-Reason Code: <b>'.$reason_code = $_GET['reasoncode'].'</b><br>';
} else {
	echo "-No Reason Code Provided<br>";
}

/* Echo Reason if we want it */
if ($_GET['reason']){
	echo '-Reason: <b>'.$reason = $_GET['reason'].'</b><br>';
} else {
	echo "-No Reason Provided<br>";
}

/* Timebound isn't really useful in my world */
// echo 'Timebound: '.$timebound = $_GET['timebound'].'<br>';

/* Policy Action */
if ($_GET['action']){
	echo '-Action: <b>'.$action = $_GET['action'].'</b><br>';
} else {
	echo "-No Action Was Provided<br>";
}


/* Policy Kind 						
	Lets add something more descriptive here 	*/
if ($_GET['kind']){
	$kind = $_GET['kind'];
	switch ($kind) {
		case "category":
			echo '-Policy Type (kind): <b>Category URL Filtering Policy</b><br>';
			break;
		case "data_leakage":
			echo '-Policy Type (kind): <b>Data Loss Prevention Policy (DLP)</b><br>';
			break;
		case "access":
			echo '-Policy Type (kind): <b>Malware Protection Policy (Security Exceptions) </b><br>';
			break;
		case "antivirus":
			echo '-Policy Type (kind): <b>Malware Protection Policy AV or Other Signature</b><br>';
			break;
		case "bandwidth_control":
			echo '-Policy Type (kind): <b>Bandwidth Control Policy</b><br>';
			break;
		case "blocked_ftp_access":
			echo '-Policy Type (kind): <b>FTP Control Policy</b><br>';
			break;
		case "file_type":
			echo '-Policy Type (kind): <b>File Type Policy</b><br>';
			break;
		case "p2p":
			echo '-Policy Type (kind): <b>Advanced Threat Protection Policy:p2p</b><br>';
			break;
		case "social_networking":
			echo '-Policy Type (kind): <b>Cloud App Control Policy (Social Networking & Blogging)</b><br>';
			break;
		case "social_networking_upload":
			echo '-Policy Type (kind): <b>Cloud App Control Policy (Social Networking & Blogging > Posting)</b><br>';
			break;
		case "streamed_media":
			echo '-Policy Type (kind): <b>Cloud App Control Policy (Streaming Media & File Sharing)</b><br>';
			break;
		case "streamed_media_upload":
			echo '-Policy Type (kind): <b>Cloud App Control Policy (Streaming Media & File Sharing > Uploading)</b><br>';
			break;
		case "wac":
			echo '-Policy Type (kind): <b>Browser Control</b><br>';
			break;
		case "webim":
			echo '-Policy Type (kind): <b>Cloud App Control Policy (Instant Messaging)</b><br>';
			break;
		case "webim_attachment":
			echo '-Policy Type (kind): <b>Cloud App Control Policy (Instant Messaging > File Transfers)</b><br>';
			break;
		case "webmail":
			echo '-Policy Type (kind): <b>App Control Policy (Webmail >Viewing Mail)</b><br>';
			break;
		case "webmail_attachment":
			echo '-Policy Type (kind): <b>Cloud App Control Policy (Webmail > Sending Attachments)</b><br>';
			break;
		case "webmail_data_leakage":
			echo '-Policy Type (kind): <b>Webmail - DLP Policy</b><br>';
			break;
		case "webmail_quota":
			echo '-Policy Type (kind): <b>Cloud App Control Policy (Webmail > Time Quota)  </b><br>';
			break;
	}
	//echo '-Kind: <b>'.$reason_code = $_GET['kind'].'</b><br>';
} else {
	echo "-No Polic Kind Was Provided<br>";
}




/* Category */
if ($_GET['cat']){
	echo '-Zscaler URL Category: <b>'.$cat = $_GET['cat'].'</b><br>';
} else {
	echo "-No Category Was Provided<br>";
}

// User already provided:
// echo 'User: '.$user = $_GET['user'].'<br>';


/* Language of Transaction */
if ($_GET['lang']){
	echo '-Language: <b>'.$lan = $_GET['lang'].'</b><br>';
} else {
	echo "-No Language Was Provided<br>";
}


echo '<br>Other Variables usefull if using API to remediate:<br>';
/* Rule ID */
if ($_GET['rule']){
	echo '-Rule ID: <b>'.$rule = $_GET['rule'].'</b><br>';
} else {
	echo "-No Rule ID Was Provided<br>";
}
if ($_GET['locid']){
	echo '-Location: <b>'.$locid = $_GET['locid'].'</b><br>';
} else {
	echo "-No Location ID Was Provided<br>";
}
if ($_GET['zsq']){
	echo '-ZSQ ID: <b>'.$zsq = $_GET['zsq'].'</b><br>';
} else {
	echo "-No ZSQ ID Was Provided<br>";
}

?>
</pre> 


</div>
	<!-- Caution Handling Code below -->
	<h2>
	<script>
		if (reasoncode == "CATEGORY_CAUTIONED") {
        		document.write("<form action='https://gateway.zscaler.net/_sm_ctn?_sm_url=",url,"&_sm_rid=",sm_rid,"' method='POST'><input type='submit' value='Continue'></form>");
			document.write("<h3>You may choose to proceed to the site by clicking the (Continue) button below, but be advised that your action will be logged. Press the (Back) button on your browser to go back.</h3>");
		}
	</script>

	<br>
	</h2>Customize your Support Options Here:</h2>
	<hr>

	<?php
		// Create a Support Email Link that packages up some of the important bits.
		$companyemail = 'support@company.com';
		$subject = 'Web Policy Block Inquiry';
		$body = 'User: '.$_GET['user'];
		$body .= '%0ATried to visit';
		$body .= '%0AURL: '.$_GET['url'];
		$body .= '%0AAnd was blocked for reason: '.$_GET['reasoncode'];
		$body .= '%0A%0APlease Investigate.';
		$body .= '%0A%0ASubmitted by EUN Mailto Link.';
		//echo $body;
		
		echo "<h3>If you have questions Click: <a href=\"mailto:".$companyemail."?subject=".$subject.".&body=".$body."\">[Email Support]</a>";
		echo " to open an ticket via email.<br></h3>";
		
	?>

</fieldset> <!-- Fieldset Inner -->
</fieldset> <!-- Fieldset Outer -->
</body>
</html>
